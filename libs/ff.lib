#!/bin/bash
# ff function library

## globals

	# set shell options for this session
	shopt -s nullglob

	ff_tmpMask=${TMP:-/tmp}/ff_tmp$$
	ff_tmp_userScript=${ff_tmpMask}.script
	ff_tmp_swapFile=${ff_tmpMask}.swap

## functions

	# allows user to input scripting commands
	ff_getScript()
	{
		if [ ${ff_cmdOpts_optEn_editor:-0} -eq 1 ] && [ ! -z "$EDITOR" ] 
		then
			# launch user's editor
			$EDITOR "$ff_tmp_userScript"
		else
			# take user input from terminal or file
			cat > "$ff_tmp_userScript"
		fi
		
		# check if no input was given
		[ ! -s "$ff_tmp_userScript" ] && return 1
		
		return 0
	}
	
	# save user script
	ff_saveScript()
	{
		if [ ${ff_cmdOpts_optEn_saveInput:-0} -eq 1 ] && [ ! -z "$ff_cmdOpts_optArg_saveInput" ]
		then
			cp -i "$ff_tmp_userScript" "$ff_cmdOpts_optArg_saveInput"
		fi
	}
	
	# if user's script doesn't include main() function,
	# add it for them before evaluating their script
	ff_checkScriptMain()
	{
		grep 'main()' "$ff_tmp_userScript" >& /dev/null
		
		if [ $? -ne 0 ]
		then
			awk "BEGIN { print \"main(){ \" } { print } END { print \"}\" }" "$ff_tmp_userScript" > "$ff_tmp_swapFile"
			mv "$ff_tmp_swapFile" "$ff_tmp_userScript"
		fi
	}
	
	# load user's script into RAM
	ff_evalScript()
	{
		g_input=$( cat "$ff_tmp_userScript" )
		eval "$g_input"
		g_input=
	}
	
	# clean up and exit program
	ff_exit()
	{
		# clean up temp files
		rm -f ${ff_tmpMask}*
		
		# exit with given code
		exit $1
	}
	
	# display variables
	ff_debug()
	{
		echo
		echo "ff_debug(): \$fn = '$fn'"
		echo "ff_debug(): \$f = '$f'"
		echo "ff_debug(): \$d = '$d'"
		echo "ff_debug(): \$w = '$w'"
		echo
	}

